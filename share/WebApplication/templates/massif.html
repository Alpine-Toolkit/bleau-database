{# -*- engine: jinja2 -*- #}
{% extends "include/geoportail-base.html" %}
{% block head %}
  {{ super() }}
  <link href="http://cdn.pydata.org/bokeh/release/bokeh-0.10.0.min.css" rel="stylesheet" type="text/css">
{% endblock %}
{% block script %}
  {{ super() }}
  <script src="http://cdn.pydata.org/bokeh/release/bokeh-0.10.0.min.js"></script>
  {# {{ circuit_statistics.circuit_grade_barchart.script|safe }} #}
  {{ circuit_statistics.boulder_grade_barchart.script|safe }}
{% endblock %}
{% block content %}
  <ul class="breadcrumb">
    <li><a href="/main">Accueil</a></li>
    <li>{{ massif.secteur }}</li>
    <li class="active">{{ massif.name }}</li>
  </ul>

  <div class="row">
    <div class="col-xl-12">

      <h1>
	{{ massif.secteur }} ~ {{ massif.name }}
	{% if massif.alternative_name %} ~ {{ massif.alternative_name }}{% endif %}
      </h1>

      <h2>Accés</h2>
      <dl>
	<dt>Accés en voiture</dt>
	<dd>
	  {{ massif.acces }}<br>
	  {% if massif.parking %}
	  <a href="/main/google-map/{{ massif.name }}">Itineraire Google Map</a>
	  {% else %}
	  Pas d'itineraire renseigné
	  {% endif %}
	</dd>
        <dt>Accés à vélo {% if massif.a_pieds %}/ à pieds{% endif %}</dt>
	<dd>{{ massif.velo }}</dd>
      </dl>
      
      <h2>Informations</h2>
      <dl>
	<dt>Type de chaos</dt><dd>{{ massif.chaos_type }}</dd>
        <dt>Notes</dt><dd>{{ massif.note }}</dd>
        <dt>Rendez-vous Gums</dt><dd>{{ massif.rdv }}</dd>
	{% with places = massif.nearest_point_deau(distance_max=5000) %}
	  {% if places %}
	    <dt>Point d'eau</dt>
	    <dd>
	      {% for place in places %}
		{% if loop.index > 1  %}<br>{% endif %}
		<a href="/main/place/{{ place.name }}">
		  {{ place.name }} ({{ massif.distance_to(place) | round | int }} m)
		</a>
	      {% endfor %}
	    </dd>
	  {% endif %}
	{% endwith %}
      </dl>
      
      <h2>Circuits</h2>
      <table class="table table-sm">
	{#
	<col style="width: 5%">
	<col style="width: 5%">
	<col style="width: 10%">
	<col style="width: 80%">
	#}
	<tbody>
	  {% for circuit in massif %}
	    <tr>
	      <td>{{ circuit.grade }}</td>
	      <td><a href="/main/circuit/{{ circuit.name }}">N° {{ circuit.number }}</a></td>
	      <td>{{ circuit.colour }}</td>
	      <td>#{{ circuit.number_of_boulders }}</td>
	      <td>
		{% for topo in circuit.topos %}
		  <a class="hidden-sm-up" href="{{ topo }}">lien</a>
		  <a class="hidden-xs-down" href="{{ topo }}">{{ topo|truncate(70) }}</a>
		  <br>
		{% endfor %}
	      </td>
	    </tr>
	  {% endfor %}
	</tbody>
      </table>

      {# {{ circuit_statistics.circuit_grade_barchart.div|safe }} #}
      {{ circuit_statistics.boulder_grade_barchart.div|safe }}

      <h2>Massifs à proximité</h2>
      <div class="alert alert-info" role="alert">
	critère: 2 km à vol d'oiseau, donc prévoir plus long!
      </div>
      {% with massif_voisins = massif.nearest(number_of_items=100, distance_max=2000) %}
	{% if massif_voisins %}
	  <table class="table table-sm">
	    {# <col style="width:10%"> #}
	    <tbody>
	      {% for massif_ in massif_voisins %}
		<tr>
		  <td class="text-right">{{ massif.distance_to(massif_) | round | int }} m</td>
		  <td/>
		  <td><a href="/main/massif/{{ massif_.name }}">{{ massif_.name }}</a></td>
		  <td>
		    <ul class="list-inline">
		      {% for cotation in massif_.cotations %}
			<li>{{ cotation }}</li>
		      {% endfor %}
		    </ul>
		  </td>
		</tr>
	      {% endfor %}
	    </tbody>
	  </table>
	{% else %}
	  <p>aucun</p>
	{% endif %}
      {% endwith %}
      
      <h2>Carte de situation</h2>
      <div class="row">
	<div class="col-xl-4">
	  <table class="table table-sm">
	    <tbody>
	      <tr>
		<td>
		  <a href="http://spatialreference.org/ref/epsg/wgs-84/">
		    Coordonnée WGS 84
		  </a></td>
		<td>
		  {% with coordinate = massif.coordinate %}
		    {{ coordinate.longitude }}, {{ coordinate.latitude }}°
		  {% endwith %}
		</td>
	      </tr>
	      <tr>
		<td>
		  <a href="http://spatialreference.org/ref/sr-org/epsg3857-wgs84-web-mercator-auxiliary-sphere/">
		    Coordonnée Mercator
		  </a></td>
		<td>
		  {% with mercator = massif.coordinate.mercator %}
		    {{ mercator[0] | round | int }}, {{ mercator[1] | round | int }} m
		  {% endwith %}
		</td>
	      </tr>
	      <tr>
		<td>Parcelles ONF</td>
		<td>{{ massif.parcelles }}</td>
	      </tr>
	    </tbody>
	  </table>
	</div>
	<div class="col-xl-4">
	  <form>
	    <label>Projection</label>
	    <select id="projection">
	      <option value="EPSG:4326">WGS 84</option>
	      <option value="EPSG:3857">Mercator</option>
	    </select>
	    <label>Precision</label>
	    <input id="precision" style="width: 3em" type="number" min="0" max="12" value="4"/>
	  </form>
	  <p id="mouse-position">Position : &nbsp;</p>
	  <p id="massif-name">Massif : &nbsp;</p>
	</div>
      </div>
      <a href="/main/geoportail/{{ massif.name }}">Grande carte</a>
      {{ geoportail_map() }}
    </div>
  </div>
{% endblock %}
